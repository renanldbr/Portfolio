The proposal for this project arose from the following question: what if we could group the companies listed on B3 based on their financial indicators from the last year and, from these groups, build a stock portfolio aimed at asset appreciation? After all, the vast majority of investors who access the stock market do so with the goal of increasing their wealth through asset appreciation.
To answer this question, we used the K-means algorithm, an unsupervised learning method that allows us to find groups (clusters) of data with similar characteristics. K-means takes as input a set of data and a desired number k of clusters, and returns as output the centers of the clusters and the labels of each data point. The algorithm works as follows:
- Choose k random points as initial cluster centers.
- Assign each data point to the cluster whose center is closest, using some distance measure (such as Euclidean).
- Recalculate the center of each cluster as the mean of the data points belonging to it.
- Repeat steps 2 and 3 until the centers no longer change or until a maximum number of iterations is reached.
The challenge of K-means is choosing an appropriate value for k, as this can affect the quality of the clusters found. One way to evaluate this is to use the elbow method, which involves plotting the sum of squared distances (SSE) between data points and cluster centers as a function of k, and observing at which point there is a sharp change in the curve, indicating a possible optimal value for k.
To apply K-means to company data, we used the following financial indicators from the last year:

- Tax Effect Of Unusual Items,
- Tax Rate For Calcs,
- Normalized EBITDA,
- Net Income From Continuing Operation Net Minority Interest,
- Net Interest Income,
- EBIT,
- Interest Expense,
- Normalized Income,
- Diluted NI Availto Com Stockholders,
- Net Income Common Stockholders,
- Net Income Including Noncontrolling Interests,
- Net Income Continuous Operations,
- Tax Provision,
- Pretax Income
- Selling General And Administration,
- Total Revenue,
- Operating Revenue.

These indicators were obtained with the help of the yfinance library, which gathers financial information from companies listed on B3.
After standardizing the data, we applied K-means with different values of k and plotted the elbow method graph. The result was as follows:


```python
import pandas as pd
import numpy as np
import yfinance as yf
from pandas_datareader import data as pdr
```

```python
ativos_b3 = pd.read_csv(r'assets/IBRX.csv', sep=';')
ativos_b3
```

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ATIVOS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>RRRP3.SA</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ALSO3.SA</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ALPA4.SA</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ABEV3.SA</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ARZZ3.SA</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>94</th>
      <td>VAMO3.SA</td>
    </tr>
    <tr>
      <th>95</th>
      <td>VIIA3.SA</td>
    </tr>
    <tr>
      <th>96</th>
      <td>VBBR3.SA</td>
    </tr>
    <tr>
      <th>97</th>
      <td>WEGE3.SA</td>
    </tr>
    <tr>
      <th>98</th>
      <td>YDUQ3.SA</td>
    </tr>
  </tbody>
</table>
<p>99 rows × 1 columns</p>
</div>




```python
frames = []
df = pd.DataFrame
columns = ['EBIT','Normalized EBITDA', 'Net Income', 'Total Revenue', 'Gross Profit','Net Interest Income', 'Pretax Income','Diluted EPS','Operating Income', 'Total Expenses']
for ativo in ativos_b3['ATIVOS']:
   try:
      dados = yf.Ticker(ativo).income_stmt
      if not dados.empty:
         dados = dados.iloc[:,:1]
         dados.rename(columns={dados.columns[0]:ativo}, inplace=True)
         frames.append(dados.to_dict())

   except:
      continue

```


```python
data = {}
for item in frames:
    key = list(item.keys())[0]
    sub_dict = item[key]
    for sub_key, value in sub_dict.items():
        data.setdefault(sub_key,{})[key] = value
df = pd.DataFrame(data)
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Tax Effect Of Unusual Items</th>
      <th>Tax Rate For Calcs</th>
      <th>Normalized EBITDA</th>
      <th>Total Unusual Items</th>
      <th>Total Unusual Items Excluding Goodwill</th>
      <th>Net Income From Continuing Operation Net Minority Interest</th>
      <th>Reconciled Depreciation</th>
      <th>Reconciled Cost Of Revenue</th>
      <th>EBIT</th>
      <th>Net Interest Income</th>
      <th>...</th>
      <th>Depreciation Amortization Depletion Income Statement</th>
      <th>Impairment Of Capital Assets</th>
      <th>Amortization Of Intangibles Income Statement</th>
      <th>Salaries And Wages</th>
      <th>Net Income Extraordinary</th>
      <th>Insurance And Claims</th>
      <th>Preferred Stock Dividends</th>
      <th>Provision For Doubtful Accounts</th>
      <th>Average Dilution Earnings</th>
      <th>Depletion Income Statement</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>RRRP3.SA</th>
      <td>-3.222816e+08</td>
      <td>0.400000</td>
      <td>9.214500e+08</td>
      <td>-8.057040e+08</td>
      <td>-8.057040e+08</td>
      <td>1.495690e+08</td>
      <td>2.793020e+08</td>
      <td>8.355440e+08</td>
      <td>-1.635560e+08</td>
      <td>-4.803000e+07</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>ALSO3.SA</th>
      <td>-8.092354e+06</td>
      <td>0.129600</td>
      <td>8.263710e+08</td>
      <td>-6.244100e+07</td>
      <td>-6.244100e+07</td>
      <td>1.558750e+08</td>
      <td>2.021100e+08</td>
      <td>3.099990e+08</td>
      <td>5.618200e+08</td>
      <td>-1.519030e+08</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>ALPA4.SA</th>
      <td>-6.570304e+07</td>
      <td>0.320000</td>
      <td>6.919050e+08</td>
      <td>-2.053220e+08</td>
      <td>-2.053220e+08</td>
      <td>1.966640e+08</td>
      <td>1.635090e+08</td>
      <td>2.254163e+09</td>
      <td>3.230740e+08</td>
      <td>-1.651100e+07</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>ABEV3.SA</th>
      <td>-8.911200e+08</td>
      <td>0.400000</td>
      <td>2.474810e+10</td>
      <td>-2.227800e+09</td>
      <td>-2.227800e+09</td>
      <td>1.445790e+10</td>
      <td>5.956300e+09</td>
      <td>4.042210e+10</td>
      <td>1.656400e+10</td>
      <td>-1.249700e+09</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>ARZZ3.SA</th>
      <td>6.487200e+04</td>
      <td>0.106000</td>
      <td>7.006610e+08</td>
      <td>6.120000e+05</td>
      <td>6.120000e+05</td>
      <td>4.247090e+08</td>
      <td>1.660300e+08</td>
      <td>1.950092e+09</td>
      <td>5.352430e+08</td>
      <td>-1.088570e+08</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>VAMO3.SA</th>
      <td>-3.272558e+07</td>
      <td>0.144000</td>
      <td>2.264194e+09</td>
      <td>-2.272610e+08</td>
      <td>-2.272610e+08</td>
      <td>6.686290e+08</td>
      <td>3.219550e+08</td>
      <td>2.821051e+09</td>
      <td>1.714978e+09</td>
      <td>-5.942570e+08</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>VIIA3.SA</th>
      <td>-5.920000e+07</td>
      <td>0.400000</td>
      <td>1.801000e+09</td>
      <td>-1.480000e+08</td>
      <td>-1.480000e+08</td>
      <td>-3.420000e+08</td>
      <td>1.118000e+09</td>
      <td>2.130800e+10</td>
      <td>5.350000e+08</td>
      <td>-2.244000e+09</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>VBBR3.SA</th>
      <td>-2.468400e+07</td>
      <td>0.204000</td>
      <td>3.746000e+09</td>
      <td>-1.210000e+08</td>
      <td>-1.210000e+08</td>
      <td>1.537000e+09</td>
      <td>5.530000e+08</td>
      <td>1.739570e+11</td>
      <td>3.072000e+09</td>
      <td>-9.630000e+08</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>WEGE3.SA</th>
      <td>4.209781e+07</td>
      <td>0.164700</td>
      <td>5.503962e+09</td>
      <td>2.556030e+08</td>
      <td>2.556030e+08</td>
      <td>4.208084e+09</td>
      <td>5.655570e+08</td>
      <td>2.120924e+10</td>
      <td>5.194008e+09</td>
      <td>-1.305510e+08</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>YDUQ3.SA</th>
      <td>2.583032e+06</td>
      <td>0.364269</td>
      <td>1.262166e+09</td>
      <td>7.091000e+06</td>
      <td>7.091000e+06</td>
      <td>-5.544400e+07</td>
      <td>7.085420e+08</td>
      <td>1.982472e+09</td>
      <td>5.607150e+08</td>
      <td>-8.508830e+08</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>98 rows × 73 columns</p>
</div>




```python
df.info()
```

    <class 'pandas.core.frame.DataFrame'>
    Index: 98 entries, RRRP3.SA to YDUQ3.SA
    Data columns (total 73 columns):
     #   Column                                                      Non-Null Count  Dtype  
    ---  ------                                                      --------------  -----  
     0   Tax Effect Of Unusual Items                                 98 non-null     float64
     1   Tax Rate For Calcs                                          98 non-null     float64
     2   Normalized EBITDA                                           98 non-null     float64
     3   Total Unusual Items                                         93 non-null     float64
     4   Total Unusual Items Excluding Goodwill                      93 non-null     float64
     5   Net Income From Continuing Operation Net Minority Interest  98 non-null     float64
     6   Reconciled Depreciation                                     97 non-null     float64
     7   Reconciled Cost Of Revenue                                  86 non-null     float64
     8   EBIT                                                        98 non-null     float64
     9   Net Interest Income                                         98 non-null     float64
     10  Interest Expense                                            98 non-null     float64
     11  Interest Income                                             93 non-null     float64
     12  Normalized Income                                           98 non-null     float64
     13  Net Income From Continuing And Discontinued Operation       98 non-null     float64
     14  Total Expenses                                              91 non-null     float64
     15  Rent Expense Supplemental                                   29 non-null     float64
     16  Diluted Average Shares                                      90 non-null     float64
     17  Basic Average Shares                                        90 non-null     float64
     18  Diluted EPS                                                 90 non-null     float64
     19  Basic EPS                                                   90 non-null     float64
     20  Diluted NI Availto Com Stockholders                         98 non-null     float64
     21  Net Income Common Stockholders                              98 non-null     float64
     22  Otherunder Preferred Stock Dividend                         66 non-null     float64
     23  Net Income                                                  98 non-null     float64
     24  Minority Interests                                          74 non-null     float64
     25  Net Income Including Noncontrolling Interests               98 non-null     float64
     26  Net Income Continuous Operations                            98 non-null     float64
     27  Tax Provision                                               98 non-null     float64
     28  Pretax Income                                               98 non-null     float64
     29  Other Non Operating Income Expenses                         27 non-null     float64
     30  Special Income Charges                                      70 non-null     float64
     31  Other Special Charges                                       49 non-null     float64
     32  Write Off                                                   31 non-null     float64
     33  Restructuring And Mergern Acquisition                       21 non-null     float64
     34  Net Non Operating Interest Income Expense                   91 non-null     float64
     35  Total Other Finance Cost                                    89 non-null     float64
     36  Interest Expense Non Operating                              91 non-null     float64
     37  Interest Income Non Operating                               85 non-null     float64
     38  Operating Income                                            88 non-null     float64
     39  Operating Expense                                           91 non-null     float64
     40  Other Operating Expenses                                    87 non-null     float64
     41  Depreciation And Amortization In Income Statement           69 non-null     float64
     42  Depreciation Income Statement                               54 non-null     float64
     43  Research And Development                                    12 non-null     float64
     44  Selling General And Administration                          98 non-null     float64
     45  General And Administrative Expense                          97 non-null     float64
     46  Rent And Landing Fees                                       24 non-null     float64
     47  Gross Profit                                                87 non-null     float64
     48  Cost Of Revenue                                             86 non-null     float64
     49  Total Revenue                                               98 non-null     float64
     50  Operating Revenue                                           98 non-null     float64
     51  Total Operating Income As Reported                          33 non-null     float64
     52  Selling And Marketing Expense                               84 non-null     float64
     53  Net Income Discontinuous Operations                         16 non-null     float64
     54  Amortization                                                16 non-null     float64
     55  Other Income Expense                                        27 non-null     float64
     56  Gain On Sale Of Ppe                                         13 non-null     float64
     57  Gain On Sale Of Business                                    2 non-null      float64
     58  Earnings From Equity Interest                               24 non-null     float64
     59  Gain On Sale Of Security                                    28 non-null     float64
     60  Other Taxes                                                 19 non-null     float64
     61  Other Gand A                                                25 non-null     float64
     62  Excise Taxes                                                14 non-null     float64
     63  Depreciation Amortization Depletion Income Statement        23 non-null     float64
     64  Impairment Of Capital Assets                                19 non-null     float64
     65  Amortization Of Intangibles Income Statement                7 non-null      float64
     66  Salaries And Wages                                          19 non-null     float64
     67  Net Income Extraordinary                                    2 non-null      float64
     68  Insurance And Claims                                        4 non-null      float64
     69  Preferred Stock Dividends                                   1 non-null      float64
     70  Provision For Doubtful Accounts                             5 non-null      float64
     71  Average Dilution Earnings                                   2 non-null      float64
     72  Depletion Income Statement                                  1 non-null      float64
    dtypes: float64(73)
    memory usage: 58.7+ KB
    


```python
df['Normalized EBITDA'].fillna(0, inplace=True)
df['EBIT'].fillna(0, inplace=True)
```


```python
cols=['Tax Effect Of Unusual Items', 'Tax Rate For Calcs','Normalized EBITDA','Net Income From Continuing Operation Net Minority Interest',
      'Net Interest Income', 'EBIT', 'Interest Expense', 'Normalized Income', 'Diluted NI Availto Com Stockholders', 'Net Income Common Stockholders',
      'Net Income Including Noncontrolling Interests', 'Net Income Continuous Operations','Tax Provision','Pretax Income','Selling General And Administration',
      'Total Revenue','Operating Revenue']
df = df[cols]
df
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Tax Effect Of Unusual Items</th>
      <th>Tax Rate For Calcs</th>
      <th>Normalized EBITDA</th>
      <th>Net Income From Continuing Operation Net Minority Interest</th>
      <th>Net Interest Income</th>
      <th>EBIT</th>
      <th>Interest Expense</th>
      <th>Normalized Income</th>
      <th>Diluted NI Availto Com Stockholders</th>
      <th>Net Income Common Stockholders</th>
      <th>Net Income Including Noncontrolling Interests</th>
      <th>Net Income Continuous Operations</th>
      <th>Tax Provision</th>
      <th>Pretax Income</th>
      <th>Selling General And Administration</th>
      <th>Total Revenue</th>
      <th>Operating Revenue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>RRRP3.SA</th>
      <td>-3.222816e+08</td>
      <td>0.400000</td>
      <td>9.214500e+08</td>
      <td>1.495690e+08</td>
      <td>-4.803000e+07</td>
      <td>-1.635560e+08</td>
      <td>5.057700e+07</td>
      <td>6.329914e+08</td>
      <td>1.495690e+08</td>
      <td>1.495690e+08</td>
      <td>1.277160e+08</td>
      <td>1.277160e+08</td>
      <td>-341849000.0</td>
      <td>-2.141330e+08</td>
      <td>8.385800e+07</td>
      <td>1.722422e+09</td>
      <td>1.722422e+09</td>
    </tr>
    <tr>
      <th>ALSO3.SA</th>
      <td>-8.092354e+06</td>
      <td>0.129600</td>
      <td>8.263710e+08</td>
      <td>1.558750e+08</td>
      <td>-1.519030e+08</td>
      <td>5.618200e+08</td>
      <td>3.066020e+08</td>
      <td>2.102236e+08</td>
      <td>1.558750e+08</td>
      <td>1.558750e+08</td>
      <td>2.221440e+08</td>
      <td>2.221440e+08</td>
      <td>33074000.0</td>
      <td>2.552180e+08</td>
      <td>4.448700e+07</td>
      <td>1.111321e+09</td>
      <td>1.111321e+09</td>
    </tr>
    <tr>
      <th>ALPA4.SA</th>
      <td>-6.570304e+07</td>
      <td>0.320000</td>
      <td>6.919050e+08</td>
      <td>1.966640e+08</td>
      <td>-1.651100e+07</td>
      <td>3.230740e+08</td>
      <td>5.212400e+07</td>
      <td>3.362830e+08</td>
      <td>1.214620e+08</td>
      <td>1.214620e+08</td>
      <td>1.085310e+08</td>
      <td>1.837330e+08</td>
      <td>87217000.0</td>
      <td>2.709500e+08</td>
      <td>9.750400e+08</td>
      <td>4.181866e+09</td>
      <td>4.181866e+09</td>
    </tr>
    <tr>
      <th>ABEV3.SA</th>
      <td>-8.911200e+08</td>
      <td>0.400000</td>
      <td>2.474810e+10</td>
      <td>1.445790e+10</td>
      <td>-1.249700e+09</td>
      <td>1.656400e+10</td>
      <td>2.328300e+09</td>
      <td>1.579458e+10</td>
      <td>1.445790e+10</td>
      <td>1.445790e+10</td>
      <td>1.489130e+10</td>
      <td>1.489130e+10</td>
      <td>-655600000.0</td>
      <td>1.423570e+10</td>
      <td>2.396950e+10</td>
      <td>7.970880e+10</td>
      <td>7.970880e+10</td>
    </tr>
    <tr>
      <th>ARZZ3.SA</th>
      <td>6.487200e+04</td>
      <td>0.106000</td>
      <td>7.006610e+08</td>
      <td>4.247090e+08</td>
      <td>-1.088570e+08</td>
      <td>5.352430e+08</td>
      <td>6.237200e+07</td>
      <td>4.241619e+08</td>
      <td>4.247090e+08</td>
      <td>4.247090e+08</td>
      <td>4.225380e+08</td>
      <td>4.225380e+08</td>
      <td>50333000.0</td>
      <td>4.728710e+08</td>
      <td>1.819611e+09</td>
      <td>4.233726e+09</td>
      <td>4.233726e+09</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>VAMO3.SA</th>
      <td>-3.272558e+07</td>
      <td>0.144000</td>
      <td>2.264194e+09</td>
      <td>6.686290e+08</td>
      <td>-5.942570e+08</td>
      <td>1.714978e+09</td>
      <td>9.339910e+08</td>
      <td>8.631644e+08</td>
      <td>6.686290e+08</td>
      <td>6.686290e+08</td>
      <td>6.686290e+08</td>
      <td>6.686290e+08</td>
      <td>112358000.0</td>
      <td>7.809870e+08</td>
      <td>4.774130e+08</td>
      <td>4.913454e+09</td>
      <td>4.913454e+09</td>
    </tr>
    <tr>
      <th>VIIA3.SA</th>
      <td>-5.920000e+07</td>
      <td>0.400000</td>
      <td>1.801000e+09</td>
      <td>-3.420000e+08</td>
      <td>-2.244000e+09</td>
      <td>5.350000e+08</td>
      <td>1.618000e+09</td>
      <td>-2.532000e+08</td>
      <td>-3.420000e+08</td>
      <td>-3.420000e+08</td>
      <td>-3.420000e+08</td>
      <td>-3.420000e+08</td>
      <td>-741000000.0</td>
      <td>-1.083000e+09</td>
      <td>7.478000e+09</td>
      <td>3.089800e+10</td>
      <td>3.089800e+10</td>
    </tr>
    <tr>
      <th>VBBR3.SA</th>
      <td>-2.468400e+07</td>
      <td>0.204000</td>
      <td>3.746000e+09</td>
      <td>1.537000e+09</td>
      <td>-9.630000e+08</td>
      <td>3.072000e+09</td>
      <td>1.142000e+09</td>
      <td>1.633316e+09</td>
      <td>1.537000e+09</td>
      <td>1.537000e+09</td>
      <td>1.537000e+09</td>
      <td>1.537000e+09</td>
      <td>393000000.0</td>
      <td>1.930000e+09</td>
      <td>2.063000e+09</td>
      <td>1.814460e+11</td>
      <td>1.814460e+11</td>
    </tr>
    <tr>
      <th>WEGE3.SA</th>
      <td>4.209781e+07</td>
      <td>0.164700</td>
      <td>5.503962e+09</td>
      <td>4.208084e+09</td>
      <td>-1.305510e+08</td>
      <td>5.194008e+09</td>
      <td>7.836600e+07</td>
      <td>3.994579e+09</td>
      <td>4.208084e+09</td>
      <td>4.208084e+09</td>
      <td>4.272872e+09</td>
      <td>4.272872e+09</td>
      <td>842770000.0</td>
      <td>5.115642e+09</td>
      <td>3.037737e+09</td>
      <td>2.990472e+10</td>
      <td>2.990472e+10</td>
    </tr>
    <tr>
      <th>YDUQ3.SA</th>
      <td>2.583032e+06</td>
      <td>0.364269</td>
      <td>1.262166e+09</td>
      <td>-5.544400e+07</td>
      <td>-8.508830e+08</td>
      <td>5.607150e+08</td>
      <td>6.479280e+08</td>
      <td>-5.995197e+07</td>
      <td>-5.544400e+07</td>
      <td>-5.544400e+07</td>
      <td>-5.824400e+07</td>
      <td>-5.824400e+07</td>
      <td>-31769000.0</td>
      <td>-8.721300e+07</td>
      <td>6.341840e+08</td>
      <td>4.564940e+09</td>
      <td>4.564940e+09</td>
    </tr>
  </tbody>
</table>
<p>98 rows × 17 columns</p>
</div>




```python
df.isna().sum()
```




    Tax Effect Of Unusual Items                                   0
    Tax Rate For Calcs                                            0
    Normalized EBITDA                                             0
    Net Income From Continuing Operation Net Minority Interest    0
    Net Interest Income                                           0
    EBIT                                                          0
    Interest Expense                                              0
    Normalized Income                                             0
    Diluted NI Availto Com Stockholders                           0
    Net Income Common Stockholders                                0
    Net Income Including Noncontrolling Interests                 0
    Net Income Continuous Operations                              0
    Tax Provision                                                 0
    Pretax Income                                                 0
    Selling General And Administration                            0
    Total Revenue                                                 0
    Operating Revenue                                             0
    dtype: int64




```python
df.columns
```




    Index(['Tax Effect Of Unusual Items', 'Tax Rate For Calcs',
           'Normalized EBITDA',
           'Net Income From Continuing Operation Net Minority Interest',
           'Net Interest Income', 'EBIT', 'Interest Expense', 'Normalized Income',
           'Diluted NI Availto Com Stockholders', 'Net Income Common Stockholders',
           'Net Income Including Noncontrolling Interests',
           'Net Income Continuous Operations', 'Tax Provision', 'Pretax Income',
           'Selling General And Administration', 'Total Revenue',
           'Operating Revenue'],
          dtype='object')




```python
df.to_csv('balanco_b3_2022_12_31.csv', sep=';', index=True)
```
```python
import pandas as pd
import numpy as np
import plotly.graph_objects as go
```

- > Realizando a leitura do arquivo


```python
maindf = pd.read_csv(r'C:\Users\Renan\PyRenan\Dashboards\balanco_b3_2022_12_31.csv', sep=';', index_col='Unnamed: 0')
maindf
```

</style>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Tax Effect Of Unusual Items</th>
      <th>Tax Rate For Calcs</th>
      <th>Normalized EBITDA</th>
      <th>Net Income From Continuing Operation Net Minority Interest</th>
      <th>Net Interest Income</th>
      <th>EBIT</th>
      <th>Interest Expense</th>
      <th>Normalized Income</th>
      <th>Diluted NI Availto Com Stockholders</th>
      <th>Net Income Common Stockholders</th>
      <th>Net Income Including Noncontrolling Interests</th>
      <th>Net Income Continuous Operations</th>
      <th>Tax Provision</th>
      <th>Pretax Income</th>
      <th>Selling General And Administration</th>
      <th>Total Revenue</th>
      <th>Operating Revenue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>RRRP3.SA</th>
      <td>-3.222816e+08</td>
      <td>0.400000</td>
      <td>9.214500e+08</td>
      <td>1.495690e+08</td>
      <td>-4.803000e+07</td>
      <td>-1.635560e+08</td>
      <td>5.057700e+07</td>
      <td>6.329914e+08</td>
      <td>1.495690e+08</td>
      <td>1.495690e+08</td>
      <td>1.277160e+08</td>
      <td>1.277160e+08</td>
      <td>-341849000.0</td>
      <td>-2.141330e+08</td>
      <td>8.385800e+07</td>
      <td>1.722422e+09</td>
      <td>1.722422e+09</td>
    </tr>
    <tr>
      <th>ALSO3.SA</th>
      <td>-8.092354e+06</td>
      <td>0.129600</td>
      <td>8.263710e+08</td>
      <td>1.558750e+08</td>
      <td>-1.519030e+08</td>
      <td>5.618200e+08</td>
      <td>3.066020e+08</td>
      <td>2.102236e+08</td>
      <td>1.558750e+08</td>
      <td>1.558750e+08</td>
      <td>2.221440e+08</td>
      <td>2.221440e+08</td>
      <td>33074000.0</td>
      <td>2.552180e+08</td>
      <td>4.448700e+07</td>
      <td>1.111321e+09</td>
      <td>1.111321e+09</td>
    </tr>
    <tr>
      <th>ALPA4.SA</th>
      <td>-6.570304e+07</td>
      <td>0.320000</td>
      <td>6.919050e+08</td>
      <td>1.966640e+08</td>
      <td>-1.651100e+07</td>
      <td>3.230740e+08</td>
      <td>5.212400e+07</td>
      <td>3.362830e+08</td>
      <td>1.214620e+08</td>
      <td>1.214620e+08</td>
      <td>1.085310e+08</td>
      <td>1.837330e+08</td>
      <td>87217000.0</td>
      <td>2.709500e+08</td>
      <td>9.750400e+08</td>
      <td>4.181866e+09</td>
      <td>4.181866e+09</td>
    </tr>
    <tr>
      <th>ABEV3.SA</th>
      <td>-8.911200e+08</td>
      <td>0.400000</td>
      <td>2.474810e+10</td>
      <td>1.445790e+10</td>
      <td>-1.249700e+09</td>
      <td>1.656400e+10</td>
      <td>2.328300e+09</td>
      <td>1.579458e+10</td>
      <td>1.445790e+10</td>
      <td>1.445790e+10</td>
      <td>1.489130e+10</td>
      <td>1.489130e+10</td>
      <td>-655600000.0</td>
      <td>1.423570e+10</td>
      <td>2.396950e+10</td>
      <td>7.970880e+10</td>
      <td>7.970880e+10</td>
    </tr>
    <tr>
      <th>ARZZ3.SA</th>
      <td>6.487200e+04</td>
      <td>0.106000</td>
      <td>7.006610e+08</td>
      <td>4.247090e+08</td>
      <td>-1.088570e+08</td>
      <td>5.352430e+08</td>
      <td>6.237200e+07</td>
      <td>4.241619e+08</td>
      <td>4.247090e+08</td>
      <td>4.247090e+08</td>
      <td>4.225380e+08</td>
      <td>4.225380e+08</td>
      <td>50333000.0</td>
      <td>4.728710e+08</td>
      <td>1.819611e+09</td>
      <td>4.233726e+09</td>
      <td>4.233726e+09</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>VAMO3.SA</th>
      <td>-3.272558e+07</td>
      <td>0.144000</td>
      <td>2.264194e+09</td>
      <td>6.686290e+08</td>
      <td>-5.942570e+08</td>
      <td>1.714978e+09</td>
      <td>9.339910e+08</td>
      <td>8.631644e+08</td>
      <td>6.686290e+08</td>
      <td>6.686290e+08</td>
      <td>6.686290e+08</td>
      <td>6.686290e+08</td>
      <td>112358000.0</td>
      <td>7.809870e+08</td>
      <td>4.774130e+08</td>
      <td>4.913454e+09</td>
      <td>4.913454e+09</td>
    </tr>
    <tr>
      <th>VIIA3.SA</th>
      <td>-5.920000e+07</td>
      <td>0.400000</td>
      <td>1.801000e+09</td>
      <td>-3.420000e+08</td>
      <td>-2.244000e+09</td>
      <td>5.350000e+08</td>
      <td>1.618000e+09</td>
      <td>-2.532000e+08</td>
      <td>-3.420000e+08</td>
      <td>-3.420000e+08</td>
      <td>-3.420000e+08</td>
      <td>-3.420000e+08</td>
      <td>-741000000.0</td>
      <td>-1.083000e+09</td>
      <td>7.478000e+09</td>
      <td>3.089800e+10</td>
      <td>3.089800e+10</td>
    </tr>
    <tr>
      <th>VBBR3.SA</th>
      <td>-2.468400e+07</td>
      <td>0.204000</td>
      <td>3.746000e+09</td>
      <td>1.537000e+09</td>
      <td>-9.630000e+08</td>
      <td>3.072000e+09</td>
      <td>1.142000e+09</td>
      <td>1.633316e+09</td>
      <td>1.537000e+09</td>
      <td>1.537000e+09</td>
      <td>1.537000e+09</td>
      <td>1.537000e+09</td>
      <td>393000000.0</td>
      <td>1.930000e+09</td>
      <td>2.063000e+09</td>
      <td>1.814460e+11</td>
      <td>1.814460e+11</td>
    </tr>
    <tr>
      <th>WEGE3.SA</th>
      <td>4.209781e+07</td>
      <td>0.164700</td>
      <td>5.503962e+09</td>
      <td>4.208084e+09</td>
      <td>-1.305510e+08</td>
      <td>5.194008e+09</td>
      <td>7.836600e+07</td>
      <td>3.994579e+09</td>
      <td>4.208084e+09</td>
      <td>4.208084e+09</td>
      <td>4.272872e+09</td>
      <td>4.272872e+09</td>
      <td>842770000.0</td>
      <td>5.115642e+09</td>
      <td>3.037737e+09</td>
      <td>2.990472e+10</td>
      <td>2.990472e+10</td>
    </tr>
    <tr>
      <th>YDUQ3.SA</th>
      <td>2.583032e+06</td>
      <td>0.364269</td>
      <td>1.262166e+09</td>
      <td>-5.544400e+07</td>
      <td>-8.508830e+08</td>
      <td>5.607150e+08</td>
      <td>6.479280e+08</td>
      <td>-5.995197e+07</td>
      <td>-5.544400e+07</td>
      <td>-5.544400e+07</td>
      <td>-5.824400e+07</td>
      <td>-5.824400e+07</td>
      <td>-31769000.0</td>
      <td>-8.721300e+07</td>
      <td>6.341840e+08</td>
      <td>4.564940e+09</td>
      <td>4.564940e+09</td>
    </tr>
  </tbody>
</table>
<p>98 rows × 17 columns</p>
</div>




```python
maindf_empresas = maindf.index
maindf_empresas
```




    Index(['RRRP3.SA', 'ALSO3.SA', 'ALPA4.SA', 'ABEV3.SA', 'ARZZ3.SA', 'ASAI3.SA',
           'AURE3.SA', 'AZUL4.SA', 'B3SA3.SA', 'BBSE3.SA', 'BBDC3.SA', 'BBDC4.SA',
           'BRAP4.SA', 'BBAS3.SA', 'BRKM5.SA', 'BRFS3.SA', 'BPAC11.SA', 'CRFB3.SA',
           'CBAV3.SA', 'CCRO3.SA', 'CMIG4.SA', 'CIEL3.SA', 'COGN3.SA', 'CPLE6.SA',
           'CSAN3.SA', 'CPFE3.SA', 'CMIN3.SA', 'CVCB3.SA', 'CYRE3.SA', 'DXCO3.SA',
           'DIRR3.SA', 'ECOR3.SA', 'ELET3.SA', 'ELET6.SA', 'EMBR3.SA', 'ENGI11.SA',
           'ENEV3.SA', 'EGIE3.SA', 'EQTL3.SA', 'EZTC3.SA', 'FLRY3.SA', 'GGBR4.SA',
           'GOAU4.SA', 'GOLL4.SA', 'GMAT3.SA', 'NTCO3.SA', 'SOMA3.SA', 'HAPV3.SA',
           'HYPE3.SA', 'IGTI11.SA', 'IRBR3.SA', 'ITSA4.SA', 'ITUB4.SA', 'JBSS3.SA',
           'KLBN11.SA', 'RENT3.SA', 'LWSA3.SA', 'LREN3.SA', 'MDIA3.SA', 'MGLU3.SA',
           'MRFG3.SA', 'CASH3.SA', 'BEEF3.SA', 'MOVI3.SA', 'MRVE3.SA', 'MULT3.SA',
           'PCAR3.SA', 'PETR3.SA', 'PETR4.SA', 'RECV3.SA', 'PRIO3.SA', 'PETZ3.SA',
           'PSSA3.SA', 'QUAL3.SA', 'RADL3.SA', 'RDOR3.SA', 'RAIL3.SA', 'SBSP3.SA',
           'SANB11.SA', 'STBP3.SA', 'SMTO3.SA', 'CSNA3.SA', 'SIMH3.SA', 'SLCE3.SA',
           'SUZB3.SA', 'TAEE11.SA', 'VIVT3.SA', 'TIMS3.SA', 'TOTS3.SA', 'TRPL4.SA',
           'UGPA3.SA', 'USIM5.SA', 'VALE3.SA', 'VAMO3.SA', 'VIIA3.SA', 'VBBR3.SA',
           'WEGE3.SA', 'YDUQ3.SA'],
          dtype='object')



- > Normalizando os dados


```python
from sklearn.preprocessing import StandardScaler
scaler = StandardScaler()
maindf_scaled = scaler.fit_transform(maindf)
maindf_scaled = pd.DataFrame(maindf_scaled, columns=maindf.columns)
maindf_scaled
```
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Tax Effect Of Unusual Items</th>
      <th>Tax Rate For Calcs</th>
      <th>Normalized EBITDA</th>
      <th>Net Income From Continuing Operation Net Minority Interest</th>
      <th>Net Interest Income</th>
      <th>EBIT</th>
      <th>Interest Expense</th>
      <th>Normalized Income</th>
      <th>Diluted NI Availto Com Stockholders</th>
      <th>Net Income Common Stockholders</th>
      <th>Net Income Including Noncontrolling Interests</th>
      <th>Net Income Continuous Operations</th>
      <th>Tax Provision</th>
      <th>Pretax Income</th>
      <th>Selling General And Administration</th>
      <th>Total Revenue</th>
      <th>Operating Revenue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.888485</td>
      <td>1.377892</td>
      <td>-0.476852</td>
      <td>-0.486851</td>
      <td>-0.150840</td>
      <td>-0.549521</td>
      <td>-0.287966</td>
      <td>-0.421116</td>
      <td>-0.489478</td>
      <td>-0.489481</td>
      <td>-0.508600</td>
      <td>-0.499956</td>
      <td>-0.516251</td>
      <td>-0.517583</td>
      <td>-0.476147</td>
      <td>-0.630725</td>
      <td>-0.638280</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.047454</td>
      <td>-0.761294</td>
      <td>-0.484930</td>
      <td>-0.486063</td>
      <td>-0.157834</td>
      <td>-0.471831</td>
      <td>-0.278981</td>
      <td>-0.473490</td>
      <td>-0.488672</td>
      <td>-0.488674</td>
      <td>-0.496922</td>
      <td>-0.488457</td>
      <td>-0.380473</td>
      <td>-0.473828</td>
      <td>-0.480621</td>
      <td>-0.642488</td>
      <td>-0.649970</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.124162</td>
      <td>0.744997</td>
      <td>-0.496355</td>
      <td>-0.480966</td>
      <td>-0.148718</td>
      <td>-0.497401</td>
      <td>-0.287912</td>
      <td>-0.457874</td>
      <td>-0.493074</td>
      <td>-0.493077</td>
      <td>-0.510973</td>
      <td>-0.493135</td>
      <td>-0.360865</td>
      <td>-0.472361</td>
      <td>-0.374864</td>
      <td>-0.583380</td>
      <td>-0.591235</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-2.582999</td>
      <td>1.377892</td>
      <td>1.547613</td>
      <td>1.301048</td>
      <td>-0.231742</td>
      <td>1.242068</td>
      <td>-0.208032</td>
      <td>1.457162</td>
      <td>1.340966</td>
      <td>1.340965</td>
      <td>1.317167</td>
      <td>1.297925</td>
      <td>-0.629875</td>
      <td>0.829491</td>
      <td>2.238454</td>
      <td>0.870513</td>
      <td>0.853490</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.071754</td>
      <td>-0.947998</td>
      <td>-0.495611</td>
      <td>-0.452471</td>
      <td>-0.154936</td>
      <td>-0.474677</td>
      <td>-0.287552</td>
      <td>-0.446987</td>
      <td>-0.454280</td>
      <td>-0.454283</td>
      <td>-0.472140</td>
      <td>-0.464053</td>
      <td>-0.374222</td>
      <td>-0.453537</td>
      <td>-0.278879</td>
      <td>-0.582382</td>
      <td>-0.590243</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>93</th>
      <td>-0.025926</td>
      <td>-0.647373</td>
      <td>-0.362764</td>
      <td>-0.421991</td>
      <td>-0.187615</td>
      <td>-0.348323</td>
      <td>-0.256964</td>
      <td>-0.392601</td>
      <td>-0.423076</td>
      <td>-0.423078</td>
      <td>-0.441707</td>
      <td>-0.434085</td>
      <td>-0.351760</td>
      <td>-0.424813</td>
      <td>-0.431419</td>
      <td>-0.569297</td>
      <td>-0.577240</td>
    </tr>
    <tr>
      <th>94</th>
      <td>-0.104790</td>
      <td>1.377892</td>
      <td>-0.402119</td>
      <td>-0.548275</td>
      <td>-0.298683</td>
      <td>-0.474703</td>
      <td>-0.232959</td>
      <td>-0.530901</td>
      <td>-0.552364</td>
      <td>-0.552367</td>
      <td>-0.566688</td>
      <td>-0.557157</td>
      <td>-0.660803</td>
      <td>-0.598582</td>
      <td>0.364197</td>
      <td>-0.069095</td>
      <td>-0.080192</td>
    </tr>
    <tr>
      <th>95</th>
      <td>-0.001970</td>
      <td>-0.172701</td>
      <td>-0.236860</td>
      <td>-0.313484</td>
      <td>-0.212440</td>
      <td>-0.202980</td>
      <td>-0.249664</td>
      <td>-0.297192</td>
      <td>-0.311986</td>
      <td>-0.311989</td>
      <td>-0.334318</td>
      <td>-0.328336</td>
      <td>-0.250126</td>
      <td>-0.317698</td>
      <td>-0.251217</td>
      <td>2.828953</td>
      <td>2.799581</td>
    </tr>
    <tr>
      <th>96</th>
      <td>0.196966</td>
      <td>-0.483611</td>
      <td>-0.087492</td>
      <td>0.020281</td>
      <td>-0.156396</td>
      <td>0.024296</td>
      <td>-0.286991</td>
      <td>-0.004669</td>
      <td>0.029722</td>
      <td>0.029720</td>
      <td>0.004019</td>
      <td>0.004833</td>
      <td>-0.087242</td>
      <td>-0.020719</td>
      <td>-0.140439</td>
      <td>-0.088215</td>
      <td>-0.099192</td>
    </tr>
    <tr>
      <th>97</th>
      <td>0.079255</td>
      <td>1.095217</td>
      <td>-0.447902</td>
      <td>-0.512468</td>
      <td>-0.204892</td>
      <td>-0.471949</td>
      <td>-0.267003</td>
      <td>-0.506961</td>
      <td>-0.515705</td>
      <td>-0.515708</td>
      <td>-0.531597</td>
      <td>-0.522602</td>
      <td>-0.403955</td>
      <td>-0.505751</td>
      <td>-0.413602</td>
      <td>-0.576006</td>
      <td>-0.583907</td>
    </tr>
  </tbody>
</table>
<p>98 rows × 17 columns</p>
</div>



- > Calculando os Clusteres


```python
from sklearn.cluster import KMeans
n_clusters = 3
kmeans = KMeans(n_clusters)
results = kmeans.fit(maindf_scaled)
df1 = pd.merge(maindf_scaled, pd.DataFrame(kmeans.labels_, columns=['cluster']), left_index=True, right_index=True)
# df1.sort_values(by=['clusters'])
df1.groupby('cluster').mean()
```
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Tax Effect Of Unusual Items</th>
      <th>Tax Rate For Calcs</th>
      <th>Normalized EBITDA</th>
      <th>Net Income From Continuing Operation Net Minority Interest</th>
      <th>Net Interest Income</th>
      <th>EBIT</th>
      <th>Interest Expense</th>
      <th>Normalized Income</th>
      <th>Diluted NI Availto Com Stockholders</th>
      <th>Net Income Common Stockholders</th>
      <th>Net Income Including Noncontrolling Interests</th>
      <th>Net Income Continuous Operations</th>
      <th>Tax Provision</th>
      <th>Pretax Income</th>
      <th>Selling General And Administration</th>
      <th>Total Revenue</th>
      <th>Operating Revenue</th>
    </tr>
    <tr>
      <th>cluster</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.025405</td>
      <td>0.018990</td>
      <td>-0.149445</td>
      <td>-0.276057</td>
      <td>-0.215108</td>
      <td>-0.153349</td>
      <td>-0.225208</td>
      <td>-0.272358</td>
      <td>-0.266954</td>
      <td>-0.266954</td>
      <td>-0.272480</td>
      <td>-0.273837</td>
      <td>-0.238163</td>
      <td>-0.270738</td>
      <td>-0.215868</td>
      <td>-0.191745</td>
      <td>-0.189370</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.686181</td>
      <td>-0.438473</td>
      <td>0.264239</td>
      <td>2.346813</td>
      <td>2.831502</td>
      <td>0.362473</td>
      <td>2.912942</td>
      <td>2.215296</td>
      <td>2.200834</td>
      <td>2.200833</td>
      <td>2.315533</td>
      <td>2.350083</td>
      <td>1.404984</td>
      <td>2.158757</td>
      <td>2.675361</td>
      <td>1.942981</td>
      <td>1.919196</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-3.532152</td>
      <td>0.689618</td>
      <td>5.725486</td>
      <td>4.070690</td>
      <td>-0.337933</td>
      <td>5.555364</td>
      <td>-0.173545</td>
      <td>4.366412</td>
      <td>4.176516</td>
      <td>4.176517</td>
      <td>4.020983</td>
      <td>3.960445</td>
      <td>5.680791</td>
      <td>4.492205</td>
      <td>0.242364</td>
      <td>1.732242</td>
      <td>1.709786</td>
    </tr>
  </tbody>
</table>
</div>



- > Método do Cotovelo


```python
inertia = []
for k in range(1,11):
    kmeans = KMeans(n_clusters=k, random_state=50).fit(df1).inertia_
    inertia.append(kmeans)

inertia
```

    C:\Users\Renan\anaconda3\lib\site-packages\sklearn\cluster\_kmeans.py:1036: UserWarning: KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
      warnings.warn(
    




    [1679.7653061224487,
     853.2281169731714,
     629.3355841347441,
     467.04567207134187,
     391.421650026564,
     321.41647480472506,
     277.3626398582809,
     232.45040729566426,
     209.9909772387195,
     181.03065027359764]




```python
fig = go.Figure()
fig.add_trace(go.Scatter(x=list(range(1, len(inertia)+1)), y=inertia, mode='lines+markers'))
fig.add_trace(go.Scatter(x=[1, len(inertia)], y=[inertia[0], inertia[-1]], mode='lines', line=dict(color='red', dash='dash')))
fig.show()
```


```python
def numero_ideal_de_clusters(inertia):
    x1, y1 = 1, inertia[0]
    x2, y2 = 10, inertia[len(inertia)-1]

    distancias = []
    for i in range(len(inertia)):
        x0 = i+2
        y0 = inertia[i]
        numerador = abs((y2-y1)*x0 - (x2-x1)*y0 + x2*y1 - y2*x1)
        denominador = np.sqrt((y2 - y1)**2 + (x2 - x1)**2)
        distancias.append(numerador/denominador)

    return distancias.index(max(distancias))+2

```


```python
numero_ideal_de_clusters(inertia)
```




    4




```python
from sklearn.cluster import KMeans
n_clusters = 4
kmeans = KMeans(n_clusters)
results = kmeans.fit(maindf_scaled)
df1 = pd.merge(maindf_scaled, pd.DataFrame(kmeans.labels_, columns=['cluster']), left_index=True, right_index=True)
# df1.sort_values(by=['clusters'])
df1.groupby('cluster').mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Tax Effect Of Unusual Items</th>
      <th>Tax Rate For Calcs</th>
      <th>Normalized EBITDA</th>
      <th>Net Income From Continuing Operation Net Minority Interest</th>
      <th>Net Interest Income</th>
      <th>EBIT</th>
      <th>Interest Expense</th>
      <th>Normalized Income</th>
      <th>Diluted NI Availto Com Stockholders</th>
      <th>Net Income Common Stockholders</th>
      <th>Net Income Including Noncontrolling Interests</th>
      <th>Net Income Continuous Operations</th>
      <th>Tax Provision</th>
      <th>Pretax Income</th>
      <th>Selling General And Administration</th>
      <th>Total Revenue</th>
      <th>Operating Revenue</th>
    </tr>
    <tr>
      <th>cluster</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.407378</td>
      <td>-0.108585</td>
      <td>1.220246</td>
      <td>1.262103</td>
      <td>0.111423</td>
      <td>1.413916</td>
      <td>0.086763</td>
      <td>1.101608</td>
      <td>1.216494</td>
      <td>1.216493</td>
      <td>1.404697</td>
      <td>1.352761</td>
      <td>0.697824</td>
      <td>1.213245</td>
      <td>0.643936</td>
      <td>1.176474</td>
      <td>1.183401</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.043921</td>
      <td>0.019856</td>
      <td>-0.226100</td>
      <td>-0.351696</td>
      <td>-0.214046</td>
      <td>-0.241596</td>
      <td>-0.224118</td>
      <td>-0.342138</td>
      <td>-0.347130</td>
      <td>-0.347130</td>
      <td>-0.361802</td>
      <td>-0.359189</td>
      <td>-0.278584</td>
      <td>-0.346355</td>
      <td>-0.241100</td>
      <td>-0.231672</td>
      <td>-0.230754</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.028973</td>
      <td>-0.544616</td>
      <td>-0.555144</td>
      <td>2.826056</td>
      <td>4.441090</td>
      <td>-0.532004</td>
      <td>4.619716</td>
      <td>2.798484</td>
      <td>2.768478</td>
      <td>2.768478</td>
      <td>2.777966</td>
      <td>2.857233</td>
      <td>1.614231</td>
      <td>2.600857</td>
      <td>3.654047</td>
      <td>1.646046</td>
      <td>1.624134</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-3.532152</td>
      <td>0.689618</td>
      <td>5.725486</td>
      <td>4.070690</td>
      <td>-0.337933</td>
      <td>5.555364</td>
      <td>-0.173545</td>
      <td>4.366412</td>
      <td>4.176516</td>
      <td>4.176517</td>
      <td>4.020983</td>
      <td>3.960445</td>
      <td>5.680791</td>
      <td>4.492205</td>
      <td>0.242364</td>
      <td>1.732242</td>
      <td>1.709786</td>
    </tr>
  </tbody>
</table>
</div>




```python
maindf_empresas = pd.Series(maindf_empresas, name='ticker').to_frame()
```


```python
df = pd.merge(maindf_empresas, df1, right_index=True, left_index=True)
```


```python
df.to_csv('kmeans-empresas-b3.csv', sep=';', index=True)
```
Analyzing the results of the clusters, we can conclude that each cluster represents a different type of company in terms of financial performance and risk

- Cluster 0: Companies with solid financial indicators, with positive or near-zero values for most variables. These are companies with stable financial performance and low unusual effects on taxes.

- Cluster 1: Companies with near-zero or negative values for most variables. These may be companies with weak financial performance or in a loss situation.

- Cluster 2: Companies with relatively low values for most variables, especially for the tax rate. These may be companies with below-average financial performance and high tax rate for calculations.

- Cluster 3: Companies with very high values for most variables, indicating extremely strong financial performance, especially in terms of normalized EBITDA and net profit.

Now that we have an updated view of the clusters, the choice of the ideal cluster for investment will still depend on the risk profile of each investor. Some additional considerations:

- Cluster 0: Continues to be an option for more conservative investors, as these companies have stable financial performance and lower risk of unusual effects on taxes.

- Cluster 1: Companies with weak performance or in a loss situation may be risky for investment unless there is a specific strategy to recover performance. This cluster may be more attractive to investors with high-risk strategies, such as turnaround (recovery of companies in difficulty).

- Cluster 2: May be more risky due to below-average financial performance and high tax rate for calculations. Investors with a higher appetite for risk may consider these companies if they are looking for high-growth opportunities.

- Cluster 3: Companies with extremely strong financial performance may be attractive to investors seeking high returns and have a higher tolerance for risk.
